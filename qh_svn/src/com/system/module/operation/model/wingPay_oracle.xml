<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="wingPay">
	<!-- 地图信息 -->
	<select id="getMapInfo" parameterType="java.lang.Object" resultType="com.frame.common.BaseMap">
		SELECT * FROM DUAL
	</select>
 	<!-- 最近七天用户数 -->
	<select id="getUserInfo" parameterType="java.lang.Object" resultType="com.frame.common.BaseMap">
		SELECT F.DAY_ID day_id,
		       F.PARTNER_TYPE pay_type,
		       SUM(F.CONSUME_USER) sum_value
		  FROM TB_LARGE_BESTPAY_CONSUME F,
		       VW_LOC_AREA      B,
		       VW_LOC_AREA      C
		 WHERE F.DAY_ID > TO_CHAR(SYSDATE - 7, 'YYYYMMDD')
		   AND F.LATN_ID = B.ZONE_NUMBER
		   AND B.AREA_LEVEL = 3
		   AND F.AREA_ID = C.AREA_ID
		   AND C.AREA_LEVEL = 4
		   AND EXISTS (SELECT 1
		          FROM TB_LARGE_USER_AREA_REL A
		         WHERE A.AREA_ID = F.AREA_ID
		           AND A.USER_ID = #{userId})
		<if test="areaName!=null and areaName!=''">
		   AND EXISTS (SELECT 1
		          FROM TB_LARGE_AREA G
		         WHERE G.AREA_LEVEL = 4
		           AND G.AREA_NAME = #{areaName}
		           AND G.AREA_ID = C.AREA_ID)
		</if>
		<if test="latnName!=null and latnName!=''">
		   AND EXISTS (SELECT 1
		          FROM TB_LARGE_AREA G
		         WHERE G.AREA_LEVEL = 3
		           AND G.AREA_NAME = #{latnName}
		           AND G.AREA_ID = B.AREA_ID)
		</if>
		 GROUP BY F.PARTNER_TYPE, F.DAY_ID
		 ORDER BY F.DAY_ID, F.PARTNER_TYPE
    </select>
    <!-- 分析结果 -->
    <select id="getResultInfo" parameterType="java.lang.Object" resultType="com.frame.common.BaseMap">
		SELECT * FROM DUAL
    </select>
    <!-- 最近七天翼支付金额 -->
    <select id="getMoneyInfo" parameterType="java.lang.Object" resultType="com.frame.common.BaseMap">
		SELECT F.DAY_ID day_id,
		       F.PARTNER_TYPE pay_type,
		       round(SUM(F.CONSUME_CHARGE)/10000,2) sum_value
		  FROM TB_LARGE_BESTPAY_CONSUME F,
		       VW_LOC_AREA      B,
		       VW_LOC_AREA      C
		 WHERE F.DAY_ID > TO_CHAR(SYSDATE - 7, 'YYYYMMDD')
		   AND F.LATN_ID = B.ZONE_NUMBER
		   AND B.AREA_LEVEL = 3
		   AND F.AREA_ID = C.AREA_ID
		   AND C.AREA_LEVEL = 4
		   AND EXISTS (SELECT *
		          FROM TB_LARGE_USER_AREA_REL A
		         WHERE A.AREA_ID = F.AREA_ID
		           AND A.USER_ID = #{userId})
		<if test="areaName!=null and areaName!=''">
		   AND EXISTS (SELECT *
		          FROM TB_LARGE_AREA G
		         WHERE G.AREA_LEVEL = 4
		           AND G.AREA_NAME = #{areaName}
		           AND G.AREA_ID = C.AREA_ID)
		</if>
		<if test="latnName!=null and latnName!=''">
		   AND EXISTS (SELECT *
		          FROM TB_LARGE_AREA G
		         WHERE G.AREA_LEVEL = 3
		           AND G.AREA_NAME = #{latnName}
		           AND G.AREA_ID = B.AREA_ID)
		</if>
		 GROUP BY F.PARTNER_TYPE, F.DAY_ID
		 ORDER BY F.DAY_ID, F.PARTNER_TYPE
    </select>
</mapper>